apiVersion: v1
kind: Namespace
metadata:
  name: loadtest
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: loadtest
  namespace: loadtest
spec:
  replicas: 4
  selector:
    matchLabels:
      app: loadtest
  template:
    metadata:
      labels:
        app: loadtest
    spec:
      containers:
      - name: burn
        image: busybox:1.36
        command:
          - sh
          - -c
          - |
            while true; do
              BURST="$(awk 'BEGIN{srand(); printf "%d\n", 5+int(rand()*16)}')"
              SLEEP="$(awk 'BEGIN{srand(); printf "%d\n", 1+int(rand()*10)}')"
              echo "burst=${BURST}s sleep=${SLEEP}s"
              end=$(( $(date +%s) + BURST ))
              while [ "$(date +%s)" -lt "$end" ]; do :; done
              sleep "$SLEEP"
            done
        resources:
          requests:
            cpu: "100m"
            memory: "32Mi"
          limits:
            cpu: "500m"
            memory: "64Mi"
